```{r}
library(tidyverse)
library(quantmod)
library(xts)
library(xtsExtra)
library(readr)
library(tsbox)
library(tseries)
library(forecast)
source('prewhiten.R')
```
```{r}
SPSITE <- read_delim("SPSITE.csv", ";", escape_double = FALSE, 
    col_types = cols(Date = col_date(format = "%d.%m.%Y")), 
    trim_ws = TRUE)
SPSITE <- na.exclude(SPSITE)
SPSITE$Close <- SPSITE$Close / 100

SPSITE.xts = xts(SPSITE$Close, SPSITE$Date)

quantmod::getSymbols(c('TMUS', '^GSPC'), from = '2006-06-09', to = '2020-09-18')
```
```{r}
plot(GSPC$GSPC.Close, main = 'S&P 500')
plot(SPSITE.xts, main = "S&P Telecom Select Industry Index")
plot(TMUS$TMUS.Adjusted, main = "T-Mobile US, Inc.")
```
```{r}
quantmod::candleChart(TMUS, theme = 'white', up.col = 'green', dm.col = 'red')
quantmod::addSMA(n = c(20, 50, 200))
```
```{r}
par(mfrow=c(1,1))
plot(GSPC$GSPC.Close, main = 'S&P 500 & S&P Telecom (red)', ylab='', xlab = 'Год')
par(new=TRUE)
plot(SPSITE.xts, main = '', col = 'red', axes = FALSE, ylab='', xlab = '', grid.col = NA)
axis(4, col = 'red')
```
```{r}
GSPC.ts <- tsbox::ts_ts(GSPC$GSPC.Close)
SPSITE.ts <- tsbox::ts_ts(SPSITE.xts)

aa = auto.arima(SPSITE.ts)

telecom::prewhiten(SPSITE.ts, GSPC.ts, na.action = na.exclude, lag.max = 50, x.model = aa)
```

